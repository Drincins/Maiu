# Maiu Inventory MVP

Внутренний учет для интернет-магазина одежды: товары, склад, операции, маркировка, финансы и базовые отчеты.

## Быстрый старт

1. Установить зависимости:

```bash
npm install
```

2. Создать `.env.local` на основе `.env.example` и заполнить ключи Supabase.

3. Запустить:

```bash
npm run dev
```

Открыть `http://localhost:3000`.

## Supabase setup

1. Создайте новый проект в Supabase.
2. В SQL Editor выполните по порядку:
   - `supabase/schema.sql` (содержит таблицы, индексы, RLS, view)
   - `supabase/rpc.sql` (RPC `create_operation`)
   - `supabase/seed.sql` (опционально, сейчас пустой)
3. Auth:
   - Включите Email/Password.
4. Storage buckets:
   - `product-images` (public)
   - `finance-attachments` (public для MVP или private + signed URLs)

## Переменные окружения

См. `.env.example`:

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY` (не обязателен для MVP)

## Архитектура

- Next.js 16 (App Router), TypeScript, Tailwind
- Supabase Postgres + Auth + Storage
- Supabase SSR auth через `@supabase/ssr`
- Формы: react-hook-form + zod
- Сканер: `@zxing/browser`

## Бизнес-логика

- Остатки считаются через `stock_movements` (нет отдельного столбца остатка).
- Себестоимость фиксирована на SKU и снимается в snapshot при операциях.
- Операции создаются через RPC `create_operation(payload jsonb)`.

## Инициализация справочников

При первом входе автоматически создаются:
- Локации: `Склад Продажи`, `Склад Реклама/PR`, `Продано`, `Списано/Брак`
- Источники оплаты: `Наличные`, `Карта физ`
- Категории расходов/доходов

Дополнительные справочники (контрагенты, промокоды) можно добавить через Supabase Table Editor для MVP.

## Мини-отчеты

В разделе `/reports` доступны:
- Продажи за 30 дней
- Финансы за 30 дней
- Блогеры (остатки на локациях blogger)
- Остатки по складам

## PWA

Manifest находится в `src/app/manifest.ts`. Иконки-заглушки:
- `public/icon-192x192.png`
- `public/icon-512x512.png`

Для установки на рабочий стол используйте HTTPS или localhost.

## Sanity checks (ручные)

1. Логин (MVP)
   - Откройте `/login` и зарегистрируйте пользователя (email + пароль).
   - Если в Supabase включено подтверждение email, подтвердите письмо и затем войдите.
2. Справочники
   - Проверьте, что создались базовые локации и категории.
3. Товары
   - Создайте модель и SKU.
4. Операции
   - Создайте приход на склад.
   - Переместите товар между локациями.
5. Маркировка
   - Для SKU с `is_marked=true` выполните операцию sale, добавив скан/вставку кодов.
6. Финансы
   - Создайте транзакцию доход/расход.
7. Отчеты
   - Убедитесь, что видны агрегаты.

## Важно

- Деньги хранятся в базе в копейках (integer). В UI ввод производится в RUB.
- Если для маркированного товара не введены коды — необходимо отметить флажок "Маркировка не обработана".
